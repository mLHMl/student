<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据可视化 - 学校考勤管理系统</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- 引入SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF', // 深蓝色主色调
                        secondary: '#3B82F6', // 辅助色
                        success: '#10B981', // 成功状态色(出勤率高)
                        warning: '#F59E0B', // 警告状态色(出勤率中等)
                        danger: '#EF4444', // 危险状态色(出勤率低)
                        info: '#06B6D4', // 信息色
                        purple: '#8B5CF6', // 紫色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .hover-scale {
                transition: transform 0.2s ease;
            }
            .hover-scale:hover {
                transform: scale(1.02);
            }
        }
    </style>
</head>

<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 顶部导航栏 -->
    <header class="bg-primary text-white shadow-md fixed w-full z-10 top-0">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- 系统Logo和名称 -->
                <div class="flex items-center space-x-3">
                    <i class="fa fa-graduation-cap text-2xl"></i>
                    <h1 class="text-xl font-bold">学校考勤管理系统</h1>
                </div>
                
                <!-- 用户信息和操作 -->
                <div class="flex items-center space-x-6">
                    <button class="hover:text-gray-200 transition-all-300">
                        <i class="fa fa-bell-o"></i>
                    </button>
                    <div class="flex items-center space-x-2">
                        <img src="https://picsum.photos/id/1005/40/40" alt="用户头像" class="w-8 h-8 rounded-full object-cover">
                        <span>张主任</span>
                        <i class="fa fa-angle-down text-sm"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-24 pb-16">
        <!-- 页面标题和面包屑 -->
        <div class="mb-8">
            <div class="flex flex-wrap justify-between items-center mb-4">
                <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-gray-800">数据可视化</h2>
                <div class="flex space-x-3 mt-2 sm:mt-0">
                    <button id="export-dashboard" class="bg-secondary hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center transition-all-300">
                        <i class="fa fa-download mr-2"></i>
                        <span>导出报表</span>
                    </button>
                    <button id="refresh-data" class="bg-white border border-gray-300 hover:bg-gray-100 px-4 py-2 rounded-md flex items-center transition-all-300">
                        <i class="fa fa-refresh mr-2"></i>
                        <span>刷新数据</span>
                    </button>
                </div>
            </div>
            
            <!-- 面包屑导航 -->
            <nav class="text-sm text-gray-500">
                <a href="#" class="hover:text-primary">首页</a>
                <span class="mx-2">/</span>
                <a href="#" class="hover:text-primary">数据查询与导出</a>
                <span class="mx-2">/</span>
                <span class="text-primary">数据可视化</span>
            </nav>
        </div>
        
        <!-- 筛选和时间范围选择区 -->
        <div class="bg-white rounded-lg card-shadow p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 时间范围选择 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">时间范围</label>
                    <div class="flex">
                        <select id="time-range" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                            <option value="current-semester">当前学期</option>
                            <option value="last-semester">上一学期</option>
                            <option value="current-year">本年度</option>
                            <option value="custom">自定义范围</option>
                        </select>
                        <div class="border border-l-0 border-gray-300 rounded-r-md px-3 py-2 bg-gray-50">
                            <i class="fa fa-calendar text-gray-500"></i>
                        </div>
                    </div>
                </div>
                
                <!-- 院系选择 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">院系/部门</label>
                    <select id="dept-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                        <option value="all">全校</option>
                        <option value="accounting">会计学院</option>
                        <option value="computer">计算机学院</option>
                        <option value="foreign">外国语学院</option>
                        <option value="business">商学院</option>
                        <option value="law">法学院</option>
                    </select>
                </div>
                
                <!-- 时间粒度选择 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">数据粒度</label>
                    <div class="flex space-x-2">
                        <button class="time-granularity-btn px-4 py-2 border border-primary bg-primary text-white rounded-md transition-all-300" data-granularity="week">
                            周
                        </button>
                        <button class="time-granularity-btn px-4 py-2 border border-gray-300 hover:border-primary hover:text-primary rounded-md transition-all-300" data-granularity="month">
                            月
                        </button>
                        <button class="time-granularity-btn px-4 py-2 border border-gray-300 hover:border-primary hover:text-primary rounded-md transition-all-300" data-granularity="term">
                            学期
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 自定义时间范围（默认隐藏） -->
            <div id="custom-date-range" class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6 hidden">
                <div>
                    <label for="start-date" class="block text-sm font-medium text-gray-700 mb-1">开始日期</label>
                    <input type="date" id="start-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
                <div>
                    <label for="end-date" class="block text-sm font-medium text-gray-700 mb-1">结束日期</label>
                    <input type="date" id="end-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                </div>
            </div>
        </div>
        
        <!-- 关键指标卡片 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- 平均出勤率 -->
            <div class="bg-white rounded-lg card-shadow p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">平均出勤率</h3>
                    <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-success">
                        <i class="fa fa-check-circle"></i>
                    </div>
                </div>
                <div class="flex items-end justify-between">
                    <div>
                        <p class="text-3xl font-bold">92.5%</p>
                        <p class="text-sm text-success mt-1 flex items-center">
                            <i class="fa fa-arrow-up mr-1"></i>
                            <span>1.2% 较上周</span>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 总考勤记录数 -->
            <div class="bg-white rounded-lg card-shadow p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">总考勤记录数</h3>
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-primary">
                        <i class="fa fa-list-alt"></i>
                    </div>
                </div>
                <div class="flex items-end justify-between">
                    <div>
                        <p class="text-3xl font-bold">12,845</p>
                        <p class="text-sm text-success mt-1 flex items-center">
                            <i class="fa fa-arrow-up mr-1"></i>
                            <span>8.3% 较上月</span>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 缺勤人次 -->
            <div class="bg-white rounded-lg card-shadow p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">缺勤人次</h3>
                    <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-danger">
                        <i class="fa fa-times-circle"></i>
                    </div>
                </div>
                <div class="flex items-end justify-between">
                    <div>
                        <p class="text-3xl font-bold">1,023</p>
                        <p class="text-sm text-danger mt-1 flex items-center">
                            <i class="fa fa-arrow-up mr-1"></i>
                            <span>3.5% 较上月</span>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 请假人次 -->
            <div class="bg-white rounded-lg card-shadow p-6 hover-scale">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">请假人次</h3>
                    <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center text-warning">
                        <i class="fa fa-clock-o"></i>
                    </div>
                </div>
                <div class="flex items-end justify-between">
                    <div>
                        <p class="text-3xl font-bold">586</p>
                        <p class="text-sm text-success mt-1 flex items-center">
                            <i class="fa fa-arrow-down mr-1"></i>
                            <span>2.1% 较上月</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 图表区域 - 第一行 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- 出勤率趋势图 -->
            <div class="bg-white rounded-lg card-shadow p-6 lg:col-span-2">
                <div class="flex flex-wrap justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-line-chart text-primary mr-2"></i>
                        出勤率趋势
                    </h3>
                    <div class="flex space-x-2 mt-2 sm:mt-0">
                        <button class="period-btn px-3 py-1 text-sm border border-primary bg-primary text-white rounded-md transition-all-300" data-period="week">
                            本周
                        </button>
                        <button class="period-btn px-3 py-1 text-sm border border-gray-300 hover:border-primary hover:text-primary rounded-md transition-all-300" data-period="month">
                            本月
                        </button>
                        <button class="period-btn px-3 py-1 text-sm border border-gray-300 hover:border-primary hover:text-primary rounded-md transition-all-300" data-period="term">
                            本学期
                        </button>
                    </div>
                </div>
                <div class="h-80">
                    <canvas id="attendance-trend-chart"></canvas>
                </div>
            </div>
            
            <!-- 考勤类型占比 -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-pie-chart text-purple mr-2"></i>
                        考勤类型占比
                    </h3>
                    <button class="text-gray-400 hover:text-gray-600 transition-all-300">
                        <i class="fa fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="h-80 flex items-center justify-center">
                    <canvas id="attendance-type-chart"></canvas>
                </div>
                <div class="grid grid-cols-2 gap-2 mt-4">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-success mr-2"></span>
                        <span class="text-sm text-gray-600">正常</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-warning mr-2"></span>
                        <span class="text-sm text-gray-600">迟到</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-danger mr-2"></span>
                        <span class="text-sm text-gray-600">缺勤</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-primary mr-2"></span>
                        <span class="text-sm text-gray-600">请假</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 图表区域 - 第二行 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- 请假类型分析 -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-bar-chart text-info mr-2"></i>
                        请假类型分析
                    </h3>
                    <button class="text-gray-400 hover:text-gray-600 transition-all-300">
                        <i class="fa fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="h-80">
                    <canvas id="leave-type-chart"></canvas>
                </div>
            </div>
            
            <!-- 各院系出勤率对比 -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-bars text-secondary mr-2"></i>
                        各院系出勤率对比
                    </h3>
                    <button class="text-gray-400 hover:text-gray-600 transition-all-300">
                        <i class="fa fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="h-80">
                    <canvas id="dept-comparison-chart"></canvas>
                </div>
            </div>
            
            <!-- 请假TOP班级 -->
            <div class="bg-white rounded-lg card-shadow p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fa fa-trophy text-warning mr-2"></i>
                        请假TOP班级
                    </h3>
                    <button class="text-gray-400 hover:text-gray-600 transition-all-300">
                        <i class="fa fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-primary mr-3">1</div>
                        <div class="flex-1">
                            <p class="font-medium">22级计算机科学与技术1班</p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="bg-danger h-2 rounded-full" style="width: 85%"></div>
                            </div>
                        </div>
                        <span class="ml-3 font-semibold text-danger">85人次</span>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-primary mr-3">2</div>
                        <div class="flex-1">
                            <p class="font-medium">23级会计学3班</p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="bg-danger h-2 rounded-full" style="width: 72%"></div>
                            </div>
                        </div>
                        <span class="ml-3 font-semibold text-danger">72人次</span>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-primary mr-3">3</div>
                        <div class="flex-1">
                            <p class="font-medium">22级商务英语2班</p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="bg-danger h-2 rounded-full" style="width: 68%"></div>
                            </div>
                        </div>
                        <span class="ml-3 font-semibold text-danger">68人次</span>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-primary mr-3">4</div>
                        <div class="flex-1">
                            <p class="font-medium">23级法学1班</p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="bg-warning h-2 rounded-full" style="width: 55%"></div>
                            </div>
                        </div>
                        <span class="ml-3 font-semibold text-warning">55人次</span>
                    </div>
                    
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-primary mr-3">5</div>
                        <div class="flex-1">
                            <p class="font-medium">22级市场营销班</p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="bg-warning h-2 rounded-full" style="width: 42%"></div>
                            </div>
                        </div>
                        <span class="ml-3 font-semibold text-warning">42人次</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 异常考勤预警 -->
        <div class="bg-white rounded-lg card-shadow p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold flex items-center">
                    <i class="fa fa-exclamation-triangle text-warning mr-2"></i>
                    异常考勤预警
                </h3>
                <button class="text-primary hover:text-primary/80 text-sm font-medium transition-all-300">
                    查看全部
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">班级</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">出勤率</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">较上周变化</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">连续下降周数</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">预警等级</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">23级软件工程2班</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">78.3%</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-danger flex items-center">
                                    <i class="fa fa-arrow-down mr-1"></i>6.2%
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">3周</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    严重
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a href="#" class="text-primary hover:text-primary/80">查看详情</a>
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">22级国际贸易班</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">82.5%</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-danger flex items-center">
                                    <i class="fa fa-arrow-down mr-1"></i>3.8%
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">2周</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                    警告
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a href="#" class="text-primary hover:text-primary/80">查看详情</a>
                            </td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">23级金融学1班</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">87.2%</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-danger flex items-center">
                                    <i class="fa fa-arrow-down mr-1"></i>2.1%
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">1周</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                    注意
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <a href="#" class="text-primary hover:text-primary/80">查看详情</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    
    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p>© 2024 学校考勤管理系统 版权所有</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="hover:text-gray-300 transition-all-300">帮助中心</a>
                    <a href="#" class="hover:text-gray-300 transition-all-300">联系我们</a>
                    <a href="#" class="hover:text-gray-300 transition-all-300">隐私政策</a>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- 导出报表弹窗 -->
    <div id="export-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">导出报表</h3>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">选择导出内容</label>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="export-trend" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
                            <label for="export-trend" class="ml-2 text-sm text-gray-700">出勤率趋势数据</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="export-type" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
                            <label for="export-type" class="ml-2 text-sm text-gray-700">考勤类型占比数据</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="export-leave" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
                            <label for="export-leave" class="ml-2 text-sm text-gray-700">请假类型分析数据</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="export-dept" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
                            <label for="export-dept" class="ml-2 text-sm text-gray-700">院系对比数据</label>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">选择导出格式</label>
                    <div class="flex space-x-4">
                        <label class="flex flex-col items-center cursor-pointer">
                            <div class="w-20 h-20 border-2 border-gray-200 rounded-lg flex items-center justify-center hover:border-primary transition-all-300 mb-1 export-format-btn" data-format="excel">
                                <i class="fa fa-file-excel-o text-4xl text-green-600"></i>
                            </div>
                            <span class="text-sm">Excel</span>
                        </label>
                        <label class="flex flex-col items-center cursor-pointer">
                            <div class="w-20 h-20 border-2 border-gray-200 rounded-lg flex items-center justify-center hover:border-primary transition-all-300 mb-1 export-format-btn" data-format="pdf">
                                <i class="fa fa-file-pdf-o text-4xl text-red-600"></i>
                            </div>
                            <span class="text-sm">PDF</span>
                        </label>
                        <label class="flex flex-col items-center cursor-pointer">
                            <div class="w-20 h-20 border-2 border-gray-200 rounded-lg flex items-center justify-center hover:border-primary transition-all-300 mb-1 export-format-btn" data-format="png">
                                <i class="fa fa-file-image-o text-4xl text-purple-600"></i>
                            </div>
                            <span class="text-sm">图片</span>
                        </label>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="cancel-export" class="flex-1 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-all-300">
                        取消
                    </button>
                    <button id="confirm-export" class="flex-1 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-all-300">
                        确认导出
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 导出进度弹窗 -->
    <div id="export-progress-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">正在导出</h3>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <div class="flex justify-between text-sm mb-1">
                        <span>处理中，请稍候...</span>
                        <span id="export-percentage">45%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="export-progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 45%"></div>
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"></div>
                    <p class="text-sm text-gray-500" id="export-status">正在准备导出数据...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 全局变量存储当前选中的导出格式
        let selectedExportFormat = 'excel';
        
        // DOM加载完成后初始化图表和事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化所有图表
            initCharts();
            
            // 时间范围选择事件
            const timeRangeSelect = document.getElementById('time-range');
            const customDateRange = document.getElementById('custom-date-range');
            
            timeRangeSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateRange.classList.remove('hidden');
                } else {
                    customDateRange.classList.add('hidden');
                }
                
                // 模拟数据刷新
                refreshChartsWithLoading();
            });
            
            // 院系筛选事件
            document.getElementById('dept-filter').addEventListener('change', function() {
                // 模拟数据刷新
                refreshChartsWithLoading();
            });
            
            // 时间粒度选择事件
            const timeGranularityBtns = document.querySelectorAll('.time-granularity-btn');
            
            timeGranularityBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 更新按钮样式
                    timeGranularityBtns.forEach(b => {
                        b.classList.remove('border-primary', 'bg-primary', 'text-white');
                        b.classList.add('border-gray-300', 'hover:border-primary', 'hover:text-primary');
                    });
                    
                    this.classList.remove('border-gray-300', 'hover:border-primary', 'hover:text-primary');
                    this.classList.add('border-primary', 'bg-primary', 'text-white');
                    
                    // 模拟数据刷新
                    refreshChartsWithLoading();
                });
            });
            
            // 周期选择按钮事件（趋势图）
            const periodBtns = document.querySelectorAll('.period-btn');
            
            periodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 更新按钮样式
                    periodBtns.forEach(b => {
                        b.classList.remove('border-primary', 'bg-primary', 'text-white');
                        b.classList.add('border-gray-300', 'hover:border-primary', 'hover:text-primary');
                    });
                    
                    this.classList.remove('border-gray-300', 'hover:border-primary', 'hover:text-primary');
                    this.classList.add('border-primary', 'bg-primary', 'text-white');
                    
                    // 更新趋势图数据
                    updateTrendChart(this.getAttribute('data-period'));
                });
            });
            
            // 导出报表按钮事件
            const exportDashboardBtn = document.getElementById('export-dashboard');
            const exportModal = document.getElementById('export-modal');
            const cancelExportBtn = document.getElementById('cancel-export');
            const confirmExportBtn = document.getElementById('confirm-export');
            const exportFormatBtns = document.querySelectorAll('.export-format-btn');
            const exportProgressModal = document.getElementById('export-progress-modal');
            
            exportDashboardBtn.addEventListener('click', function() {
                exportModal.classList.remove('hidden');
                // 默认选中Excel格式
                selectExportFormat('excel');
            });
            
            cancelExportBtn.addEventListener('click', function() {
                exportModal.classList.add('hidden');
            });
            
            // 选择导出格式
            exportFormatBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const format = this.getAttribute('data-format');
                    selectExportFormat(format);
                });
            });
            
            function selectExportFormat(format) {
                selectedExportFormat = format;
                
                exportFormatBtns.forEach(btn => {
                    btn.classList.remove('border-primary');
                    btn.classList.add('border-gray-200');
                });
                
                document.querySelector(`.export-format-btn[data-format="${format}"]`).classList.remove('border-gray-200');
                document.querySelector(`.export-format-btn[data-format="${format}"]`).classList.add('border-primary');
            }
            
            // 确认导出
            confirmExportBtn.addEventListener('click', function() {
                exportModal.classList.add('hidden');
                exportProgressModal.classList.remove('hidden');
                
                // 模拟导出进度
                let progress = 0;
                const progressBar = document.getElementById('export-progress-bar');
                const percentageText = document.getElementById('export-percentage');
                const statusText = document.getElementById('export-status');
                
                const interval = setInterval(() => {
                    if (progress < 100) {
                        progress += Math.floor(Math.random() * 8) + 1;
                        if (progress > 100) progress = 100;
                        
                        progressBar.style.width = `${progress}%`;
                        percentageText.textContent = `${progress}%`;
                        
                        // 更新状态文本
                        if (progress < 30) {
                            statusText.textContent = "正在准备导出数据...";
                        } else if (progress < 70) {
                            statusText.textContent = "正在处理数据...";
                        } else {
                            statusText.textContent = "正在生成文件...";
                        }
                        
                        if (progress === 100) {
                            clearInterval(interval);
                            
                            // 导出完成后显示提示
                            setTimeout(() => {
                                exportProgressModal.classList.add('hidden');
                                
                                let formatName = '';
                                switch(selectedExportFormat) {
                                    case 'excel': formatName = 'Excel'; break;
                                    case 'pdf': formatName = 'PDF'; break;
                                    case 'png': formatName = '图片'; break;
                                }
                                
                                Swal.fire({
                                    title: '导出成功',
                                    text: `报表已成功导出为${formatName}格式`,
                                    icon: 'success',
                                    confirmButtonText: '确定'
                                });
                            }, 1000);
                        }
                    }
                }, 500);
            });
            
            // 刷新数据按钮事件
            document.getElementById('refresh-data').addEventListener('click', function() {
                // 显示刷新动画
                this.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>刷新中...</span>';
                this.disabled = true;
                
                // 模拟数据刷新
                setTimeout(() => {
                    refreshChartsWithLoading();
                    
                    // 恢复按钮状态
                    this.innerHTML = '<i class="fa fa-refresh mr-2"></i><span>刷新数据</span>';
                    this.disabled = false;
                    
                    Swal.fire({
                        title: '刷新成功',
                        text: '数据已更新至最新',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }, 1000);
            });
        });
        
        // 初始化所有图表
        function initCharts() {
            // 出勤率趋势图
            initTrendChart();
            
            // 考勤类型占比图
            initAttendanceTypeChart();
            
            // 请假类型分析图
            initLeaveTypeChart();
            
            // 院系对比图
            initDeptComparisonChart();
        }
        
        // 初始化出勤率趋势图
        function initTrendChart() {
            const ctx = document.getElementById('attendance-trend-chart').getContext('2d');
            
            // 本周数据
            const weekLabels = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
            const weekData = [91.2, 93.5, 90.8, 94.2, 89.7, 95.6, 92.5];
            
            window.trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weekLabels,
                    datasets: [{
                        label: '出勤率 (%)',
                        data: weekData,
                        backgroundColor: 'rgba(30, 64, 175, 0.1)',
                        borderColor: '#1E40AF',
                        borderWidth: 2,
                        pointBackgroundColor: '#1E40AF',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `出勤率: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 80,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // 更新趋势图数据
        function updateTrendChart(period) {
            let labels, data;
            
            switch(period) {
                case 'week':
                    labels = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
                    data = [91.2, 93.5, 90.8, 94.2, 89.7, 95.6, 92.5];
                    break;
                case 'month':
                    labels = ['第1周', '第2周', '第3周', '第4周'];
                    data = [90.5, 91.8, 92.3, 92.5];
                    break;
                case 'term':
                    labels = ['1月', '2月', '3月', '4月', '5月', '6月'];
                    data = [88.2, 89.5, 90.1, 91.3, 92.0, 92.5];
                    break;
            }
            
            window.trendChart.data.labels = labels;
            window.trendChart.data.datasets[0].data = data;
            window.trendChart.update();
        }
        
        // 初始化考勤类型占比图
        function initAttendanceTypeChart() {
            const ctx = document.getElementById('attendance-type-chart').getContext('2d');
            
            window.typeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['正常', '迟到', '缺勤', '请假'],
                    datasets: [{
                        data: [92.5, 2.8, 1.7, 3.0],
                        backgroundColor: [
                            '#10B981', // 成功色-正常
                            '#F59E0B', // 警告色-迟到
                            '#EF4444', // 危险色-缺勤
                            '#1E40AF'  // 主色-请假
                        ],
                        borderWidth: 0,
                        hoverOffset: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // 初始化请假类型分析图
        function initLeaveTypeChart() {
            const ctx = document.getElementById('leave-type-chart').getContext('2d');
            
            window.leaveChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['病假', '事假', '公假', '旷课', '早退'],
                    datasets: [{
                        label: '人次',
                        data: [245, 186, 78, 156, 92],
                        backgroundColor: [
                            '#3B82F6',
                            '#06B6D4',
                            '#8B5CF6',
                            '#EF4444',
                            '#F59E0B'
                        ],
                        borderRadius: 4,
                        barThickness: 30
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // 初始化院系对比图
        function initDeptComparisonChart() {
            const ctx = document.getElementById('dept-comparison-chart').getContext('2d');
            
            window.deptChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['会计学院', '计算机学院', '外国语学院', '商学院', '法学院'],
                    datasets: [{
                        label: '出勤率 (%)',
                        data: [94.2, 89.7, 95.5, 91.3, 93.1],
                        backgroundColor: '#3B82F6',
                        borderRadius: 4,
                        barThickness: 30
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `出勤率: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 85,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // 刷新所有图表并显示加载状态
        function refreshChartsWithLoading() {
            // 显示加载状态
            Swal.fire({
                title: '加载中',
                text: '正在更新数据，请稍候...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            // 模拟数据加载延迟
            setTimeout(() => {
                // 随机生成一些新数据
                const newTrendData = Array(7).fill().map(() => 88 + Math.random() * 7);
                const newTypeData = [
                    90 + Math.random() * 5,  // 正常
                    1 + Math.random() * 3,   // 迟到
                    0.5 + Math.random() * 2, // 缺勤
                    2 + Math.random() * 2    // 请假
                ];
                const newLeaveData = [
                    200 + Math.random() * 100, // 病假
                    150 + Math.random() * 80,  // 事假
                    50 + Math.random() * 50,   // 公假
                    100 + Math.random() * 80,  // 旷课
                    50 + Math.random() * 50    // 早退
                ];
                const newDeptData = [
                    90 + Math.random() * 5,  // 会计学院
                    88 + Math.random() * 5,  // 计算机学院
                    92 + Math.random() * 5,  // 外国语学院
                    89 + Math.random() * 5,  // 商学院
                    91 + Math.random() * 5   // 法学院
                ];
                
                // 更新图表数据
                window.trendChart.data.datasets[0].data = newTrendData;
                window.trendChart.update();
                
                window.typeChart.data.datasets[0].data = newTypeData;
                window.typeChart.update();
                
                window.leaveChart.data.datasets[0].data = newLeaveData;
                window.leaveChart.update();
                
                window.deptChart.data.datasets[0].data = newDeptData;
                window.deptChart.update();
                
                // 关闭加载状态
                Swal.close();
            }, 1500);
        }
    </script>
</body>
</html>
